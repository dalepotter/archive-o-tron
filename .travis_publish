#!/bin/bash
PUBLICATION_BRANCH=gh-pages

# Checkout the branch
REPO_PATH=$PWD
pushd $HOME
git clone --branch=$PUBLICATION_BRANCH https://${GITHUB_TOKEN}@github.com/$TRAVIS_REPO_SLUG.git publish 2>&1 > /dev/null
cd publish

# Update pages
echo "copy existing files"
# TODO The following command will copy files already in the repo to this folder, but we need to find out where the files downloaded in this build are!
cp -r $REPO_PATH/docs/* .
echo "list files"
ls -lh
echo "list filepaths"
echo $REPO_PATH/docs
pwd
echo "copy new files"
cp -r docs/* . # no such folder
echo "list files"
ls -lh
echo "find files with matching name"
find / -name '*Grand_Bargain_Dashboard.html*'

# Commit and push latest version
echo "git status"
git status
echo "git add"
git add .
echo "git config"
git config user.name  "Travis"
git config user.email "travis@travis-ci.org"
echo "git commit"
git commit -m "Add archived data"
echo "git push"
git push -fq origin $PUBLICATION_BRANCH 2>&1 > /dev/null
popd
